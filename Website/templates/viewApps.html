<html>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<head>
</head>
<body>

<!--Header-->
<header class="w3-container" style="background-color: black" id = viewApps>
    <h1 class="w3-large w3-cursive" style="font-family: courier new; color:white;">User Dashboard
        {% if userInfo.3 == 0 %}
            <form class="formA" method="GET" action="{% url 'admin' %}">
        {% endif %}
        {% if userInfo.3 == 1 %}
            <form class="formA" method="GET" action="{% url 'sponsor' %}">
        {% endif %}
        {% if userInfo.3 == 2 %}
            <form class="formA" method="GET" action="{% url 'user' %}">
        {% endif %}
        <button class="w3-bar-item w3-button w3-left fa fa-home"
                style="position:relative;top:-3px;left:155px;"></button>
        </form>


        <div class="w3-dropdown-hover w3-right" style="background-color:black">
            <button class="w3-button fa fa-user w3-xlarge"
                    style="color:white;background-color:black;top: -5px;position:relative"> {{ username }}</button>
            <div class="w3-dropdown-content w3-bar-block w3-card-4">
                <form class="formA" style="top:28px;" method="GET" action="{% url 'accountInfo' %}">
                    <button href="#" class="w3-bar-item w3-button"
                            style="position:relative;color:white;background-color:black;">Account
                    </button>
                </form>
                <form class="formA" style="top:54px;" method="orders" style="background-color:black"
                      action="{% url 'orders' %}">
                    <button type="submit" class="w3-bar-item w3-button"
                            style="position:relative;color:white;background-color:black;margin-bottom:-18px">Orders
                    </button>
                </form>
                {% if userInfo.3 == 2 %}
                <form class="formA" style="top:82px;" method="history" style="background-color:black"
                    action="{% url 'history' %}">
                    <button type="submit" class="w3-bar-item w3-button"
                      style="position:relative;color:white;background-color:black;margin-bottom:28px">History
                    </button>
                </form>
                {%endif%}
                <form class="formA" style="top:82px;" method="logout" style="background-color:black"
                      action="{% url 'user_login' %}">
                    <button type="submit" class="w3-bar-item w3-button" id="test-logout"
                            style="position:relative;color:white;background-color:black;margin-bottom:-18px">Log Out
                    </button>
                </form>
            </div>
        </div>



        {% if userInfo.3 == 0 %}
            <div class="w3-dropdown-hover w3-right" style="background-color:black">
                <button class="w3-button w3-bar-item"
                        style="color:white;background-color:black;top: -5px;position:relative">Change View
                </button>
                <div class="w3-dropdown-content w3-bar-block w3-card-4">
                    <form class="formA" style="top:28px;" method="GET" action="{% url 'sponsor' %}">
                        <button href="#" class="w3-bar-item w3-button"
                                style="position:relative;color:white;background-color:black;">Sponsor
                        </button>
                    </form>
                    <form class="formA" style="top:54px;" method="GET" action="{% url 'user' %}">
                        <button type="submit" class="w3-bar-item w3-button"
                                style="position:relative;color:white;background-color:black;margin-bottom:-18px">Driver
                        </button>
                    </form>
                </div>
            </div>
            <!--closed this form-->
            <form class="formA" method="GET" action="{% url 'catalog' %}">
                <button class="w3-right w3-bar-item w3-button"
                        style="color:white;background-color:black;top: -5px;position:relative">Catalog
                </button>
            </form>
            <button class="w3-right w3-bar-item w3-button"
                    style="color:white;background-color:black;top: -5px;position:relative">Drivers
            </button>
            <button class="w3-right w3-bar-item w3-button"
                    style="color:white;background-color:black;top: -5px;position:relative">Sponsors
            </button>
        {% endif %}



        {% if userInfo.3 == 1 %}
            <div class="w3-dropdown-hover w3-right" style="background-color:black">
                <button class="w3-button w3-bar-item"
                        style="color:white;background-color:black;top: -5px;position:relative">Change View
                </button>
                <div class="w3-dropdown-content w3-bar-block w3-card-4">
                    <form class="formA" style="top:28px;" method="GET" action="{% url 'sponsor' %}">
                        <button href="#" class="w3-bar-item w3-button"
                                style="position:relative;color:white;background-color:black;">Sponsor
                        </button>
                    </form>
                    <form class="formA" style="top:54px;" method="GET" action="{% url 'user' %}">
                        <button type="submit" class="w3-bar-item w3-button"
                                style="position:relative;color:white;background-color:black;margin-bottom:-18px">Driver
                        </button>
                    </form>
                </div>
            </div>
            <form class="formA" method="GET" action="{% url 'catalog' %}">
                <button class="w3-right w3-bar-item w3-button"
                        style="color:white;background-color:black;top: -5px;position:relative">Catalog
                </button>
            </form>
            <form class="formA" method="get" action="{% url 'viewApplications' %}">
                <button class="w3-right w3-bar-item w3-button"
                        style="color:white;background-color:black;top: -5px;position:relative">Drivers
                </button>
            </form>
        {% endif %}



        {% if userInfo.3 == 2 %}
            <!--closed this form-->
            <form class="formA" method="GET" action="{% url 'catalog' %}">
                <button class="w3-right w3-bar-item w3-button"
                        style="color:white;background-color:black;top: -5px;position:relative">Catalog
                </button>
            </form>
            <form class="formA" method="get" action="{% url 'selectSponsor' %}">
                <button class="w3-right w3-bar-item w3-button"
                        style="color:white;background-color:black;top: -5px;position:relative">Sponsor
                </button>
            </form>
        {% endif %}
    </h1>
</header>


<body>
<div class="w3-center">
    <p>
    <h3> Users and pending applications within your organization.
        <br>
        <button><a href="{% url 'sponsorSales' %}?pid={{ currUser.org_id }}">Sponsor Sales Report</a></button>
        <button><a href="{% url 'sponsorInvoice' %}?pid={{ currUser.org_id }}">Sponsor Invoice</a></button>
    </h3></p>
    <table name="userTab">
        <tr>
            <th scope="col">User</th>
            <th scope="col">Application Status</th>
            <th scope="col">Points</th>
            <th scope="col">Remove</th>
            {% if userInfo.3 == 0 %}
                <th scope="col">New Email</th>
                <th scope="col">New Password</th>
            {% endif %}
            <th scope="col">Download Report</th>
        </tr>
        {% for entry in connections %}
            <tr>
                {% if entry.org_id == currUser.org_id %}
                    <!--Search user table to pull email rather than use user id here-->
                    {% for name in allUsers %}
                        <!--print the info, make sure the current user is not included?-->
                        {% if name.user_id == entry.user_id and name.user_id != userInfo.0 %}
                            <td>{{ name.email }}
                                {% if userInfo.3 == 0 %}
                                    <br>
                                    Password:
                                    {{ name.password }}
                                {% endif %}
                            </td>
                            <!--check the status of the application-->
                            {% if entry.pending_app == 1 %}
                                <td>
                                    <button><a href="{% url 'acceptApp' %}?pid={{ entry.connection_id }}">Accept</a>
                                    </button>
                                    <button><a href="{% url 'denyApp' %}?pid={{ entry.connection_id }}">Deny</a>
                                    </button>
                                </td>
                            {% else %}
                                <td>Complete</td>
                            {% endif %}
                            <!--buttons for various operations, make sure they are a user-->
                            {% if name.user_type == 2 %}
                                <td>
                                    <!--Update the users' points-->
                                    <a>Balance: {{ entry.points }}</a>
                                    <div class="w3-row">
                                        <form method="POST" action="{% url 'updatePoints' %}">
                                            {% csrf_token %}
                                            <input type="text" name="points" id = testAddPoints placeholder="Add/Remove Points"/>
                                            <br>
                                            <input type="text" name="reason" id = testReason placeholder="Reason for Change"/>
                                            <br>
                                            <input type="text" name="score" value="{{ name.user_id }}"
                                                   style="visibility: hidden" ;/>
                                            <br>
                                            <input type="text" name="org" value="{{ entry.org_id }}"
                                                   style="visibility: hidden; height:0px" ;/>
                                            <br>
                                            <button name="b1" type="submit" value="add" id = testAdd>Add</button>
                                            <button name="b1" type="submit" value="subtract">Remove</button>
                                        </form>
                                    </div>
                                </td>
                                <!--Deny a driver application-->
                                <td>
                                    <button><a href="{% url 'denyApp' %}?pid={{ entry.connection_id }}">Remove
                                        Driver</a></button>
                                </td>
                            {% else %}
                                <td>N/A</td>
                                {% if userInfo.3 == 0 %}
                                    <td>
                                        <button><a href="{% url 'adminDelete' %}?pid={{ entry.connection_id }}">Remove
                                            Sponsor</a></button>
                                    </td>
                                {% else %}
                                    <td>N/A</td>
                                {% endif %}
                            {% endif %}
                            <!--if an admin, add buttons for changing a users email and password-->
                            {% if userInfo.3 == 0 %}
                                <td>
                                    <div class="w3-row">
                                        <form method="POST" action="{% url 'updateEmail' %}">
                                            {% csrf_token %}
                                            <input type="text" name="newem" placeholder="New Email"/>
                                            <br>
                                            <input type="text" name="score" value="{{ name.user_id }}"
                                                   style="visibility: hidden" ;/>
                                            <br>
                                            <button name="e1" type="submit" value="e1">Update</button>
                                        </form>
                                    </div>
                                </td>
                                <td>
                                    <div class="w3-row">
                                        <form method="POST" action="{% url 'updatePassword' %}">
                                            {% csrf_token %}
                                            <input type="text" name="newpa" placeholder="New Password"/>
                                            <br>
                                            <input type="text" name="score" value="{{ name.user_id }}"
                                                   style="visibility: hidden" ;/>
                                            <br>
                                            <button name="p1" type="submit" value="p1">Update</button>
                                        </form>
                                    </div>
                                </td>
                            {% endif %}
                            <!--Button to download report if not a sponsor-->
                            {% if name.user_type == 2 %}
                                <td>
                                    <button><a href="{% url 'driverReportSponsor' %}?pid={{ entry.user_id }}&oid={{ entry.org_id }}">Sales Report</a></button>
                                </td>
                            {% else %}
                                <td>N/A</td>
                            {% endif %}

                        {% endif %}
                    {% endfor %}
                {% endif %}
            </tr>
        {% endfor %}
    </table>

</body>
<br>
<br>
<br>
<button>
    {% if userInfo.3 == 1 %}
        <a href="{% url 'sponsor' %}">
            <i>Return to Sponsor Dashboard</i><br>
        </a>
    {% endif %}

    {% if userInfo.3 == 2 %}
        <a href="{% url 'user' %}">
            <i>Return to Driver Dashboard</i><br>
        </a>
    {% endif %}

    {% if userInfo.3 == 0 %}
        <a href="{% url 'admin' %}">
            <i>Return to Admin Dashboard</i><br>
        </a>
    {% endif %}

    <style>
        body {
            background-color: #010044;
            color: white;
        }

        w3-button {
            background-color: black;
            color: white;
        }

        .action {
            border-style: solid;
            border-width: 2px;
            border-color: white;
            float: left;
            width: 20%;
            position: relative;
            text-align: center;
            background-color: #0f99ac;
            font-weight: bold;
            color: black;
            left: 40%;
            top: 5px;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .form input {
            display: block;
            width: 78%;
            margin-left: 20px;
            padding: 5px 20px;
            font-size: 1em;
            border-radius: 3px;
            outline: none;
            border: 1px solid #ccc;
        }

        .action:hover {
            cursor: cursor
        }

        .formA {
            position: relative;
            margin-bottom: -18px;
            margin-top: -28px;
        }

        td,
        th {
            border: 1px solid rgb(190, 190, 190);
            color: white;
            padding: 10px;
        }

    </style>

</html>